### Процес генерації датасету для SupportAI

Цей документ описує покроковий процес створення та розширення датасету для навчання та тестування системи аналізу діалогів підтримки.

#### 1. Основна логіка генерації
Генерація відбувається у кілька етапів, поєднуючи реальні дані з Bitext та синтетичне розширення за допомогою LLM (Llama 3.1 8b через Ollama).

##### Крок 1: Завантаження базових даних
- Система завантажує датасет `bitext/Bitext-customer-support-llm-chatbot-training-dataset` з HuggingFace.
- Кожен діалог трансформується у внутрішній формат зі структурою: `client` -> `agent`.
- Категорії Bitext відображаються (mapping) на наші цільові інтенти (`payment_issue`, `refund_request`, `account_access` тощо) через `INTENT_MAP`.

##### Крок 2: Аналіз за допомогою LLM (Metadata Enrichment)
- Оскільки базовий датасет не містить оцінок якості, випадкова вибірка (за замовчуванням 2000 діалогів) аналізується LLM.
- LLM визначає для кожного діалогу:
    - **satisfaction**: рівень задоволеності клієнта.
    - **quality_score**: оцінка роботи агента (1-5).
    - **agent_mistakes**: список помилок агента (наприклад, `rude_tone`, `incorrect_info`).
- Для решти датасету використовуються статистичні патерни на основі отриманих результатів.

##### Крок 3: Генерація варіацій (Augmentation)
- Для ключових фраз клієнтів та агентів генеруються синонімічні варіації з різними тональностями (ввічлива, нейтральна, роздратована).
- Це дозволяє збільшити різноманітність тексту в фінальному датасеті.

##### Крок 4: Розширення датасету (Expansion)
Це ключовий етап, де створюються нові сценарії:
- **Successful cases**: Копіювання базових діалогів з підстановкою згенерованих варіацій.
- **Problematic cases**: Створення діалогів, де агент робить помилки (згідно з `AGENT_MISTAKES`), що призводить до незадоволеності клієнта.
- **Conflict cases**: Сценарії з негативним тоном клієнта або некоректною поведінкою агента.
- **Hidden dissatisfaction**: Спеціальні випадки, де клієнт виглядає задоволеним за текстом (використовує фрази як "Okay, thanks"), але насправді проблема не вирішена.

##### Крок 5: Збереження та збір статистики
- Результат зберігається у `data/dataset.json`.
- Формується файл `data/dataset_stats.json` з розподілом за інтентами, рівнем задоволеності та наявністю помилок.

---

#### 2. Компоненти системи та їх відповідальність

| Файл / Клас | Роль у системі |
| :--- | :--- |
| `generate.py` | Точка входу для запуску процесу генерації. |
| `src/generator/main.py` | Координує послідовність кроків: завантаження -> аналіз -> аугментація -> збереження. |
| `DatasetAugmenter` (`src/generator/engine.py`) | "Серце" генератора. Містить логіку взаємодії з LLM, методи створення помилок та розширення даних. |
| `src/config/constants.py` | Конфігураційні дані: ідентифікатор зерна (`SEED`), мапінг інтентів, типи помилок та фрази для прихованого незадоволення. |
| `data/dataset.json` | Фінальний продукт — готовий JSON датасет для навчання аналізатора. |
